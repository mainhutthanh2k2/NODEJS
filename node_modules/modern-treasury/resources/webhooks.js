'use strict';
// File generated from our OpenAPI spec by Stainless.
Object.defineProperty(exports, '__esModule', { value: true });
exports.Webhooks = void 0;
const resource_1 = require('modern-treasury/resource');
const crypto_1 = require('crypto');
const core_1 = require('modern-treasury/core');
class Webhooks extends resource_1.APIResource {
  /**
   * To verify that a webhook was actually sent by Modern Treasury, every payload is
   * signed with a signature that is passed through the `X-Signature` HTTP header.
   *
   * This method will generate a signature based off of your webhook key which can be
   * found in the Developer Settings,
   * https://app.moderntreasury.com/developers/webhooks, and the webhook payload.
   *
   * You can then compare the generated signature with the signature sent with the
   * request, if they match then the webhook was sent by Modern Treasury.
   */
  getSignature(payload, opts) {
    const key = (opts === null || opts === void 0 ? void 0 : opts.key) || this.client.webhookKey;
    if (key == null) {
      throw new Error(
        "The webhook key must either be set using the env var, MODERN_TREASURY_WEBHOOK_KEY, on the client class, new ModernTreasury({ webhookKey: '123' }) or passed to this function",
      );
    }
    if (!key) {
      throw new Error('The webhook key is set but appears to be empty.');
    }
    return (0, crypto_1.createHmac)('sha256', key).update(payload, 'utf8').digest('hex');
  }
  /**
   * Returns whether or not the webhook payload was sent by Modern Treasury.
   */
  validateSignature(payload, headers, opts) {
    const signature = this.getSignature(payload, opts);
    const expectedSignature =
      typeof headers === 'string' ? headers : (0, core_1.getHeader)(headers, 'X-Signature');
    if (!expectedSignature) throw new Error('Could not find an X-Signature header');
    return signature === expectedSignature;
  }
}
exports.Webhooks = Webhooks;
//# sourceMappingURL=webhooks.js.map
